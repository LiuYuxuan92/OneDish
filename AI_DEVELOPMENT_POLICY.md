# AI_DEVELOPMENT_POLICY.md

> OneDish 项目 AI 开发与提交流程规范（v1.0）

## 1. 目的
本规范用于约束“AI 生成代码”在 OneDish 项目的研发、验证、提交流程，确保在**低人工编码参与**情况下仍具备可控质量与可回滚能力。

---

## 2. 核心原则
1. **AI 可以写 100%，未验证代码不得进入主分支。**
2. **小步提交：一个任务一个目标，一个目标一个提交。**
3. **所有改动必须可回滚。**
4. **高风险改动必须人工批准后执行。**

---

## 3. 角色分工
- **主助手（Orchestrator）**：任务拆解、监督执行、结果汇总、风险评估。
- **Subagent（Executor）**：按范围实施改动并执行验证。
- **项目负责人（轩总）**：对高风险改动与最终合并做决策。

---

## 4. 标准任务输入模板
每次任务需明确以下信息：

- **任务目标**：一句话描述要实现什么
- **范围边界**：允许/禁止修改的目录或模块
- **验收标准**：功能验收 + 技术验收（lint/test/build）
- **交付要求**：改动清单、验证结果、风险、回滚方案

---

## 5. 标准执行流程（必须）
1. 主助手拆解任务并标注风险等级（绿/黄/红）
2. Subagent 实施改动（最小改动原则）
3. 执行门禁验证（lint/test/build 或 `npm run verify`）
4. 若失败，允许自动修复一轮；仍失败则输出阻塞说明
5. 输出结构化报告（见第 9 节）
6. 负责人决策：继续 / 暂停 / 回滚 / 合并

---

## 6. 可提交标准（Gate）
满足以下条件才可标记“可提交”：

- [ ] 需求目标完成
- [ ] `lint` 通过（warning 可暂留，但需在报告中披露）
- [ ] `test` 通过（或启用 no-test 临时策略并披露）
- [ ] `build` 通过
- [ ] 风险等级为可接受（高风险需人工批准）
- [ ] 回滚路径明确（commit/tag 可定位）

---

## 7. 风险分级与审批
- **绿（低）**：文案、样式、日志、非核心重构 → 可自动推进
- **黄（中）**：接口字段、查询逻辑、缓存策略 → 需重点验证
- **红（高）**：鉴权、计费、删除、配置、权限、数据迁移 → **必须人工批准**

> 规则：红色改动未经明确同意，不得落地。

---

## 8. 回滚策略（必须具备）
每次任务执行前后：

1. 记录执行前基线 commit
2. 任务结束单独 commit（避免混杂）
3. 若回滚，优先使用：`git revert <commit>`
4. 紧急情况下允许回退到基线 commit/tag

---

## 9. 统一交付报告模板
每次任务交付时，必须按以下结构输出：

1. **结论**：可提交 / 不可提交
2. **改动**：文件清单 + 每项改动说明
3. **验证**：lint/test/build 实际结果
4. **风险**：高/中/低 + 影响面
5. **回滚**：回滚命令或回滚步骤
6. **下一步**：继续建议（1-3 条）

---

## 10. 分支与提交建议
- 分支命名：`feat/<topic>`、`fix/<topic>`、`chore/<topic>`
- Commit 建议：
  - `feat: ...`
  - `fix: ...`
  - `chore: ...`
  - `refactor: ...`
  - `test: ...`

PR 描述建议包含：
- 背景与目标
- 改动范围
- 验证证据
- 风险与回滚

---

## 11. 当前项目建议（OneDish）
1. 统一使用：`npm run verify` 作为提交前一键门禁。
2. 短期允许 warning 存在，但每次任务需减少或说明。
3. 尽快补 2~3 个关键路径回归测试（鉴权、配额、搜索）。

---

## 12. 生效范围
本规范适用于 OneDish 仓库内所有由 AI 参与的代码任务，自发布即生效。
