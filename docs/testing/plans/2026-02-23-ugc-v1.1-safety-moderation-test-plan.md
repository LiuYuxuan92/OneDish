# UGC V1.1 安全与审核增强测试计划（2026-02-23）

## 1. 测试目标

验证 UGC V1.1 在“审核权限隔离 + 内容安全拦截 + 结构化字段 + 兼容性”上的最小可用实现。

## 2. 测试范围

- 后端：
  - review 接口 admin role 校验
  - 高风险词拦截逻辑
  - 新增字段写入/读取与旧数据兼容
- 前端：
  - 投稿表单结构化字段输入
  - 提交审核状态/失败原因展示
  - 非管理员不显示审核通过操作

## 3. 环境与前置

- backend: Node + knex + sqlite/pg（项目默认）
- frontend: React Native + TypeScript
- 需准备两类 token：
  - 普通用户 token（role=user）
  - 管理员 token（role=admin）

## 4. 用例设计（专项 >=5）

1. **权限隔离-普通用户审核被拒**
   - 前置：普通用户登录
   - 操作：调用 `POST /user-recipes/:id/review`
   - 期望：403，提示仅管理员可审核

2. **权限隔离-管理员可审核通过**
   - 前置：管理员登录，目标稿件为 pending
   - 操作：review action=published
   - 期望：200，状态变更为 published

3. **安全拦截-蜂蜜关键词**
   - 前置：草稿内容含“蜂蜜”
   - 操作：提交审核
   - 期望：400，返回明确拦截原因（含蜂蜜）

4. **安全拦截-整颗坚果/酒精/高盐高糖**
   - 前置：草稿文本含“整颗坚果”或“料酒/白酒”或“高盐/高糖”
   - 操作：提交审核
   - 期望：400，返回对应规则命中原因

5. **结构化字段写入读取**
   - 操作：创建草稿时提交 baby_age_range/allergens/is_one_pot/step_branches
   - 期望：草稿读取接口返回字段一致，类型正确

6. **旧数据兼容性**
   - 前置：历史数据无新增字段
   - 操作：查询我的投稿/详情
   - 期望：接口正常；新增字段返回默认值或空值，前端不报错

7. **前端可见性控制**
   - 前置：普通用户登录
   - 操作：进入投稿页
   - 期望：不出现“审核通过”按钮

## 5. 自动化/构建检查

1. backend build：`cd backend && npm run build`
2. frontend type-check：`cd frontend && npm run type-check`
3. smoke：`bash scripts/test/smoke.sh`

## 6. 出口准则

- 构建与 type-check 通过。
- smoke 可执行且核心接口不失败。
- 专项用例至少 5 条通过（必须包含权限隔离、安全拦截）。
- 关键缺陷无阻塞级（P0/P1）。