# ç®€å®¶å¨ - å¼€å‘è¿›åº¦è®°å½•

## 2026-02-20 å¼€å‘è¿›åº¦

### Phase 2-4 æ¶æ„æ”¹è¿›ï¼ˆå…¨éƒ¨å®Œæˆï¼‰

è¯¦è§ `docs/07-æ¶æ„æ”¹è¿›æ–¹æ¡ˆ.md`ï¼Œå…±å®Œæˆ 6 ä¸ªæ”¹è¿›æ–¹æ¡ˆï¼š

| Phase | å†…å®¹ | çŠ¶æ€ |
|-------|------|------|
| 2A | åŒæ­¥çƒ¹é¥ªæ—¶é—´çº¿ (`POST /recipes/:id/timeline`) | âœ… |
| 2B | æœç´¢ç»“æœä¿å­˜åˆ°æˆ‘çš„èœè°± (`user_recipes` è¡¨) | âœ… |
| 3A | æ™ºèƒ½å‘¨è®¡åˆ’ï¼ˆæœˆé¾„è¿‡æ»¤ + è¥å…»å‡è¡¡ + é£Ÿæå¤ç”¨ï¼‰ | âœ… |
| 3B | é£Ÿæç”Ÿå‘½å‘¨æœŸé—­ç¯ï¼ˆè´­ç‰©â†’åº“å­˜â†’æ‰£å‡â†’ä¸´æœŸæ¨èï¼‰ | âœ… |
| 4A | ç¦»çº¿ä¼˜å…ˆæ¶æ„ï¼ˆPersistQueryClientProvider + NetInfoï¼‰ | âœ… |
| 4B | è½¬æ¢ç¼“å­˜æŒä¹…åŒ–ï¼ˆå†…å­˜ Map â†’ SQLite transform_cache è¡¨ï¼‰ | âœ… |

### çƒ¹é¥ªæ¨¡å¼ï¼ˆCooking Modeï¼‰å®ç°

**è®¾è®¡æ–‡æ¡£ï¼š** `docs/plans/2026-02-20-cooking-mode-design.md`
**å®æ–½è®¡åˆ’ï¼š** `docs/plans/2026-02-20-cooking-mode-plan.md`

#### æ–°å¢æ–‡ä»¶

**å‰ç«¯ï¼š**
- `frontend/src/screens/recipe/CookingModeScreen.tsx` â€” å…¨å±æ²‰æµ¸å¼çƒ¹é¥ªä¸»å±å¹•
- `frontend/src/hooks/useCookingSession.ts` â€” çƒ¹é¥ªä¼šè¯çŠ¶æ€ç®¡ç† hookï¼ˆå«è¯­éŸ³æ’­æŠ¥ã€AsyncStorage æŒä¹…åŒ–ï¼‰
- `frontend/src/components/cooking/StepCard.tsx` â€” æ­¥éª¤å¡ç‰‡ï¼ˆé¢œè‰²ç¼–ç ï¼šå…±ç”¨/å¤§äºº/å®å®/åˆ†å‰ï¼‰
- `frontend/src/components/cooking/StepTimer.tsx` â€” æ­¥éª¤å€’è®¡æ—¶ç»„ä»¶
- `frontend/src/components/cooking/CrossLineAlert.tsx` â€” å¤§äºº/å®å®åˆ‡æ¢ä¸»åŠ¨æé†’ Modal
- `frontend/src/components/cooking/BabyStepCard.tsx` â€” å®å®ä¸“å±æ­¥éª¤å¡ç‰‡ï¼ˆæœˆé¾„é€‚é… + è¿‡æ•æç¤ºï¼‰
- `frontend/src/constants/babyAgeRules.ts` â€” æœˆé¾„è§„åˆ™é…ç½®ï¼ˆè´¨åœ°å»ºè®® + è¿‡æ•é£Ÿæè§„åˆ™ï¼‰

#### ä¿®æ”¹æ–‡ä»¶

**å‰ç«¯ï¼š**
- `frontend/src/types/index.ts` â€” RecipeStackParamList / HomeStackParamList / PlanStackParamList æ·»åŠ  `CookingMode` è·¯ç”±
- `frontend/src/navigation/RecipeNavigator.tsx` â€” æ³¨å†Œ CookingModeScreen
- `frontend/src/navigation/HomeNavigator.tsx` â€” æ³¨å†Œ CookingModeScreen
- `frontend/src/navigation/PlanNavigator.tsx` â€” æ³¨å†Œ CookingModeScreen
- `frontend/src/screens/recipe/RecipeDetailScreen.tsx` â€” åŒæ­¥çƒ¹é¥ª Tab åº•éƒ¨æ·»åŠ "å¼€å§‹çƒ¹é¥ª"æŒ‰é’®

#### åŠŸèƒ½è¯´æ˜

**Phase A â€” æ ¸å¿ƒæ¡†æ¶ï¼š**
- å…¨å±æ²‰æµ¸å¼ç•Œé¢ï¼Œéšè— Tab Bar
- `expo-keep-awake` å±å¹•å¸¸äº®ï¼ˆè¿›å…¥æ—¶æ¿€æ´»ï¼Œé€€å‡ºæ—¶é‡Šæ”¾ï¼‰
- çƒ¹é¥ªè¿›åº¦è‡ªåŠ¨ä¿å­˜åˆ° AsyncStorageï¼Œæ„å¤–é€€å‡ºå¯æ¢å¤
- æ­¥éª¤å¡ç‰‡æŒ‰ç±»å‹é¢œè‰²ç¼–ç ï¼ˆå…±ç”¨=é’ã€å¤§äºº=æ©™ã€å®å®=ç²‰ã€åˆ†å‰=é»„ï¼‰
- å¹¶è¡Œæ­¥éª¤å°å¡ç‰‡ï¼ˆ`parallel_with` å­—æ®µå…³è”ï¼‰
- æ­¥éª¤å€’è®¡æ—¶ï¼ˆå¼€å§‹/æš‚åœ/é‡ç½®ï¼‰

**Phase B â€” ä½“éªŒå¢å¼ºï¼š**
- `expo-speech` è¯­éŸ³æ’­æŠ¥ï¼Œæ­¥éª¤åˆ‡æ¢è‡ªåŠ¨æœ—è¯»ï¼ˆrate: 0.85ï¼Œzh-CNï¼‰
- ğŸ”Š/ğŸ”‡ å¼€å…³ï¼Œéšæ—¶é™éŸ³
- å·¦å³æ»‘åŠ¨åˆ‡æ¢æ­¥éª¤ï¼ŒåŒå‡»é‡æ–°æœ—è¯»ï¼ˆreact-native-gesture-handlerï¼‰
- å¤§äººâ†’å®å®åˆ‡æ¢æ—¶ `expo-haptics` éœ‡åŠ¨ + ä¸»åŠ¨æé†’ Modal

**Phase C â€” æœˆé¾„ç²¾ç»†åŒ–ï¼š**
- æœˆé¾„è§„åˆ™é…ç½®è¡¨ï¼ˆ6æœˆæ³¥çŠ¶ â†’ 8æœˆç³ŠçŠ¶ â†’ 10æœˆç»†ç¢ â†’ 12æœˆå°å— â†’ 18æœˆæ­£å¸¸ï¼‰
- å®å®æ­¥éª¤æ˜¾ç¤ºæœˆé¾„é€‚é…è¯´æ˜å’Œè´¨åœ°å»ºè®®
- é¦–æ¬¡å‡ºç°é«˜é£é™©è¿‡æ•é£Ÿææ—¶å¼¹å‡ºæç¤ºï¼ˆèŠ±ç”Ÿ/è™¾/èŸ¹/è›‹ç™½/èœ‚èœœ/åšæœ/ç‰›å¥¶ï¼‰
- "ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ"å±•å¼€ç§‘å­¦ä¾æ® Modal

#### ä¾èµ–å®‰è£…

```bash
npx expo install expo-speech
npx expo install expo-haptics
```

#### ä½¿ç”¨æ–¹å¼

1. æ‰“å¼€ä»»æ„èœè°±è¯¦æƒ…é¡µ
2. åˆ‡æ¢åˆ°"åŒæ­¥çƒ¹é¥ª"Tab
3. ç‚¹å‡»åº•éƒ¨"ğŸ³ å¼€å§‹çƒ¹é¥ªï¼ˆåŒæ­¥æ¨¡å¼ï¼‰"
4. è¿›å…¥å…¨å±çƒ¹é¥ªæ¨¡å¼ï¼ŒæŒ‰æ­¥éª¤æ“ä½œ

---

## 2026-02-15 å¼€å‘è¿›åº¦

### æ–°å¢åŠŸèƒ½: è”ç½‘æœç´¢èœè°±

å®ç°äº†ä¸‰ç§æœç´¢æ¥æºçš„æ™ºèƒ½åˆ‡æ¢:
1. **æœ¬åœ°æ•°æ®åº“** - å·²æœ‰80+é“èœè°±
2. **å¤©è¡Œæ•°æ®API** - è”ç½‘æ‰©å±• (å…è´¹100æ¬¡/å¤©) âœ… å·²é…ç½®
3. **MiniMax AI** - æ™ºèƒ½èœè°±æ¨è âœ… å·²é…ç½®

#### æ–°å¢æ–‡ä»¶

**åç«¯:**
- `backend/src/adapters/search.adapter.ts` - æœç´¢é€‚é…å™¨æ¥å£
- `backend/src/adapters/local.adapter.ts` - æœ¬åœ°æ•°æ®åº“é€‚é…å™¨
- `backend/src/adapters/tianxing.adapter.ts` - å¤©è¡Œæ•°æ®APIé€‚é…å™¨
- `backend/src/adapters/ai.adapter.ts` - MiniMax AIé€‚é…å™¨
- `backend/src/services/search.service.ts` - ç»Ÿä¸€æœç´¢æœåŠ¡
- `backend/src/routes/search.routes.ts` - æœç´¢APIè·¯ç”±

**å‰ç«¯:**
- `frontend/src/api/search.ts` - æœç´¢APIå°è£…
- `frontend/src/hooks/useSearch.ts` - æœç´¢Hook

#### ä¿®æ”¹æ–‡ä»¶

- `backend/src/index.ts` - æ³¨å†Œæœç´¢è·¯ç”±
- `backend/.env` - æ·»åŠ APIé…ç½®
- `frontend/src/types/index.ts` - æ·»åŠ sourceå­—æ®µ
- `frontend/src/components/recipe/RecipeCard.tsx` - æ˜¾ç¤ºæ¥æºæ ‡ç­¾
- `frontend/src/screens/recipe/RecipeListScreen.tsx` - æ·»åŠ è”ç½‘æœç´¢æŒ‰é’®

#### ä½¿ç”¨æ–¹å¼

1. åœ¨èœè°±åˆ—è¡¨é¡µé¢ï¼Œè¾“å…¥æœç´¢è¯
2. ç‚¹å‡»"è”ç½‘æœç´¢"æŒ‰é’®åˆ‡æ¢åˆ°è”ç½‘æ¨¡å¼
3. æœç´¢ç»“æœä¼šæ˜¾ç¤ºæ¥æºæ ‡ç­¾: æœ¬åœ°/è”ç½‘/AIæ¨è

---

## 2026-01-21 å¼€å‘è¿›åº¦

### å·²å®ŒæˆåŠŸèƒ½

#### 1. èœè°±ç®¡ç†æ¨¡å—
- âœ… 15ä¸ªæ–°èœè°±æ•°æ®å…¥åº“
- âœ… èœè°±è¯¦æƒ…å±•ç¤ºï¼ˆå¤§äººç‰ˆ/å®å®ç‰ˆï¼‰
- âœ… èœè°±æœç´¢åŠŸèƒ½
- âœ… èœè°±åˆ†ç±»ç­›é€‰

#### 2. é¤é£Ÿè®¡åˆ’æ¨¡å—
- âœ… ä¸€å‘¨é¤é£Ÿè®¡åˆ’å±•ç¤º
- âœ… æŒ‰æ—¥æœŸè®¾ç½®é¤é£Ÿè®¡åˆ’
- âœ… é¤é£Ÿè®¡åˆ’åˆ é™¤åŠŸèƒ½

#### 3. è´­ç‰©æ¸…å•æ¨¡å—
- âœ… ç”Ÿæˆè´­ç‰©æ¸…å•ï¼ˆåŸºäºé¤é£Ÿè®¡åˆ’ï¼‰
- âœ… è´­ç‰©æ¸…å•æŒ‰åŒºåŸŸåˆ†ç»„æ˜¾ç¤ºï¼ˆè¶…å¸‚åŒº/è”¬æœåŒº/è°ƒæ–™åŒº/å…¶ä»–ï¼‰
- âœ… å…¨é€‰/å–æ¶ˆå…¨é€‰åŠŸèƒ½
- âœ… åˆ é™¤æ¸…å•é¡¹åŠŸèƒ½
- âœ… æ‰‹åŠ¨æ·»åŠ æ¸…å•é¡¹åŠŸèƒ½
- âœ… å•ä¸ªé¡¹ç›®å‹¾é€‰åŠŸèƒ½

---

### 2026-01-21 ä¿®å¤é—®é¢˜

#### é—®é¢˜1: å•ä¸ªè´­ç‰©æ¸…å•é¡¹æ— æ³•å‹¾é€‰

**é—®é¢˜æè¿°**ï¼š
- ç‚¹å‡»å•ä¸ªè´­ç‰©æ¸…å•é¡¹æ— æ³•åˆ‡æ¢é€‰ä¸­çŠ¶æ€
- åªèƒ½é€šè¿‡"å…¨é€‰"æŒ‰é’®æ“ä½œ
- å‰ç«¯æœ‰ç‚¹å‡»äº‹ä»¶è§¦å‘ï¼ˆé»„è‰²é«˜äº®ï¼‰ï¼Œä½†UIä¸æ›´æ–°

**æ ¹æœ¬åŸå› **ï¼š
åç«¯ `updateListItem` æ–¹æ³•å­˜åœ¨ä¸¤ä¸ªbugï¼š

1. **JSONè§£æé—®é¢˜**ï¼š
   - ä»æ•°æ®åº“è¯»å–çš„ `list.items` æ˜¯JSONå­—ç¬¦ä¸²
   - ä»£ç ç›´æ¥ç±»å‹è½¬æ¢æœªè§£æ
   - å¯¼è‡´ `items[area]` è®¿é—®å¤±è´¥

2. **JSONåºåˆ—åŒ–é—®é¢˜**ï¼š
   - æ›´æ–°æ•°æ®åº“æ—¶æœªä½¿ç”¨ `JSON.stringify(items)`
   - å¯¹è±¡è¢«å­˜ä¸º `"[object Object]"` å­—ç¬¦ä¸²
   - åç»­è¯»å–å¯¼è‡´JSONè§£æå¤±è´¥

**ä¿®å¤æ–¹æ¡ˆ**ï¼š

```typescript
// ä¿®å¤1: è§£æitemsä»JSONå­—ç¬¦ä¸²åˆ°å¯¹è±¡
const items = typeof list.items === 'string'
  ? JSON.parse(list.items)
  : list.items;

// ä¿®å¤2: åºåˆ—åŒ–itemsä¸ºJSONå­—ç¬¦ä¸²å­˜å‚¨
.update({ items: JSON.stringify(items) })
```

---

#### é—®é¢˜2: è·å–è´­ç‰©æ¸…å•APIè¿”å›500é”™è¯¯

**é—®é¢˜æè¿°**ï¼š
- æ‰“å¼€ä»Šæ—¥æ¸…å•é¡µé¢ç›´æ¥å¤±è´¥
- GET `/shopping-lists?start_date=2026-01-21` è¿”å›500é”™è¯¯

**æ ¹æœ¬åŸå› **ï¼š
- æ•°æ®åº“ä¸­å­˜åœ¨corruptedæ•°æ® (`items: '[object Object]'`)
- `JSON.parse('[object Object]')` æŠ›å‡ºå¼‚å¸¸
- æœªå¤„ç†çš„å¼‚å¸¸å¯¼è‡´APIå´©æºƒ

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
åœ¨æ‰€æœ‰è§£æitemsçš„æ–¹æ³•ä¸­æ·»åŠ try-catché”™è¯¯å¤„ç†ï¼š

```typescript
let parsedItems;
try {
  parsedItems = typeof list.items === 'string'
    ? JSON.parse(list.items)
    : list.items;
} catch (e) {
  console.error('[Backend] Failed to parse items for list:', list.id, e);
  parsedItems = {
    è¶…å¸‚åŒº: [],
    è”¬æœåŒº: [],
    è°ƒæ–™åŒº: [],
    å…¶ä»–: [],
  };
}
```

**ä¿®å¤çš„æ–¹æ³•** (å…±6ä¸ª)ï¼š
1. `getShoppingLists` - è·å–å†å²è´­ç‰©æ¸…å•
2. `getShoppingListById` - è·å–å•ä¸ªæ¸…å•è¯¦æƒ…
3. `addRecipeToShoppingList` - æ·»åŠ èœè°±åˆ°æ¸…å•
4. `removeListItem` - åˆ é™¤æ¸…å•é¡¹
5. `addListItem` - æ‰‹åŠ¨æ·»åŠ æ¸…å•é¡¹
6. `toggleAllItems` - å…¨é€‰/å–æ¶ˆå…¨é€‰

---

### å¾…ä¿®å¤é—®é¢˜

#### 1. æ·»åŠ ç‰©å“å¼¹æ¡†è‡ªåŠ¨å…³é—­é—®é¢˜
**æè¿°**ï¼šç‚¹å‡»ç‰©å“åç§°æˆ–æ•°é‡çš„è¾“å…¥æ¡†æ—¶ï¼Œå¼¹æ¡†ä¼šè‡ªåŠ¨å…³é—­ï¼Œæ— æ³•è¾“å…¥
**ä¼˜å…ˆçº§**ï¼šé«˜
**ç›¸å…³æ–‡ä»¶**ï¼š`frontend/src/screens/plan/ShoppingListScreen.tsx`

#### 2. åˆ é™¤æŒ‰é’®å¯èƒ½æ— æ³•ç‚¹å‡»
**æè¿°**ï¼šç”¨æˆ·åé¦ˆåˆ é™¤åŠŸèƒ½å¯èƒ½æ— æ•ˆ
**ä¼˜å…ˆçº§**ï¼šä¸­

---

### æŠ€æœ¯æ ˆ

**åç«¯**ï¼š
- Node.js + Express
- SQLite + Knex.js
- TypeScript
- tsx watch (å¼€å‘æ¨¡å¼)

**å‰ç«¯**ï¼š
- React Native Web
- TanStack Query (React Query)
- Axios
- TypeScript

**å¼€å‘å·¥å…·**ï¼š
- Metro bundler (å‰ç«¯)
- tsx watch (åç«¯)

---

### å¼€å‘ä¿¡æ¯

- åç«¯æœåŠ¡è¿è¡Œåœ¨ç«¯å£ 3000
- å‰ç«¯å¼€å‘æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ 8085 (Web)
- æ•°æ®åº“æ–‡ä»¶ä½äº `backend/dev.sqlite3`
- æ‰€æœ‰APIè·¯å¾„ä»¥ `/api/v1` å¼€å¤´

### å¯åŠ¨å‘½ä»¤

```bash
# åç«¯
cd backend && npm run dev

# å‰ç«¯ (Web)
cd frontend && npx expo start --web --port 8085
```
