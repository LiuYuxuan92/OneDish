# 烹饪模式（Cooking Mode）设计文档

> 日期: 2026-02-20
> 优化方向: 产品深度 — "一菜两吃"厨房实操体验
> 状态: 待实施

---

## 一、背景与问题

Phase 1-4 已完成同步烹饪时间线、智能周计划、食材生命周期、离线缓存等功能。当前菜谱详情页是"规划模式"（提前看菜谱），但用户真正在厨房做饭时面临四个核心痛点：

| 痛点 | 描述 |
|------|------|
| 时间管理混乱 | 同时做两份饭，不知先做什么、何时切换，容易手忙脚乱 |
| 注意力分散 | 油手点屏幕不方便，离灶台远，看步骤需要频繁走动 |
| 宝宝版不够细 | 月龄差几个月差异大，转换规则粗糙，缺乏科学依据 |
| 两份撞时间 | 大人菜和宝宝菜常撞时间，结果一份凉了一份没熟 |

---

## 二、设计方案：厨房模式（Cooking Mode）

### 核心理念

将菜谱 App 升级为做饭助手，区分两种使用场景：

- **详情页（规划模式）** = 提前看菜谱、决定做不做
- **烹饪模式（执行模式）** = 正在做饭时的沉浸式操作引导

### 入口

- 菜谱详情页底部主按钮：**"开始烹饪"**
- 同步烹饪时间线 Tab 内：**"按时间线开始"**

---

## 三、Phase A：烹饪模式框架（核心骨架）

### 界面结构（全屏沉浸式）

```
┌─────────────────────────────────┐
│  ← 退出    番茄炒蛋    🔊 语音  │  ← 顶部栏（极简）
├─────────────────────────────────┤
│                                 │
│   步骤 3 / 8                    │  ← 进度指示
│                                 │
│   ┌──────────────────────┐      │
│   │  [大人🍽️]            │      │
│   │  热锅加油，放入蒜末   │      │  ← 当前步骤（超大字）
│   │  爆香30秒            │      │
│   └──────────────────────┘      │
│                                 │
│   ┌──────────────────────┐      │
│   │  [宝宝🍼] 同时进行   │      │  ← 并行宝宝步骤（小卡片）
│   │  宝宝的菜保持小火    │      │
│   └──────────────────────┘      │
│                                 │
│        ⏱  01:28                 │  ← 当前步骤倒计时
│   ████████████░░░░  75%         │
│                                 │
│  ← 上一步    [完成此步]  下一步→ │
└─────────────────────────────────┘
```

### 关键能力

| 能力 | 实现方式 |
|------|---------|
| 屏幕常亮 | `expo-keep-awake`，进入时激活，退出时释放 |
| 数据来源 | 复用 Phase 2A 已生成的 `SyncTimeline` 数据，无需新后端 API |
| 进度持久化 | 烹饪进度存入 AsyncStorage，意外退出可恢复到当前步骤 |
| 全屏模式 | 隐藏底部 Tab Bar，StatusBar 设为透明 |

### 涉及文件

- **新增** `frontend/src/screens/recipe/CookingModeScreen.tsx` — 主屏幕
- **新增** `frontend/src/components/cooking/StepCard.tsx` — 步骤卡片
- **新增** `frontend/src/components/cooking/StepTimer.tsx` — 倒计时组件
- **新增** `frontend/src/hooks/useCookingSession.ts` — 烹饪会话状态管理
- **修改** `frontend/src/screens/recipe/RecipeDetailScreen.tsx` — 添加"开始烹饪"按钮
- **修改** `frontend/src/types/index.ts` — RecipeStackParamList 添加 CookingMode 路由
- **修改** `frontend/src/navigation/` — 注册 CookingModeScreen

---

## 四、Phase B：语音播报 + 手势 + 主动提醒

### 语音播报

- 依赖：`expo-speech`（无需额外权限）
- 进入每个新步骤时**自动朗读**步骤内容
- 顶部栏 🔊/🔇 开关，用户可随时静音
- 语速：`rate: 0.85`（稍慢，适合边操作边听）
- 朗读内容去掉时间提示（避免"30秒"念完用户不知道计时已开始）

### 大字模式

- 步骤正文字号：22px（比详情页大 40%）
- 关键动词加粗高亮（"**翻炒**"、"**加盐**"）
- 可选深色背景模式（护眼，厨房光线复杂时更易读）

### 主动提醒

当大人/宝宝两条线有时间交叉时，震动 + 应用内弹窗：

```
┌─────────────────────────┐
│  ⚠️ 该照顾宝宝的菜了！  │
│  宝宝那锅已煮8分钟，    │
│  现在可以捞出压泥了     │
│          [好的，去看看] │
└─────────────────────────┘
```

- 震动：`expo-haptics`（无需权限）
- 提醒：应用内 Modal，不使用系统推送通知（避免权限申请）

### 手势操作（油手友好）

| 手势 | 功能 |
|------|------|
| 左右滑动 | 上一步 / 下一步 |
| 双击 | 重新朗读当前步骤 |
| 长按计时器 | 暂停 / 继续倒计时 |

### 涉及文件

- **新增** `frontend/src/components/cooking/VoiceControl.tsx` — 语音控制
- **新增** `frontend/src/components/cooking/AlertModal.tsx` — 主动提醒弹窗
- **修改** `frontend/src/hooks/useCookingSession.ts` — 添加语音/提醒逻辑
- **安装** `expo-speech`, `expo-haptics`（通常已包含在 Expo SDK）

---

## 五、Phase C：宝宝版月龄精细化

### 精细化步骤卡片

宝宝步骤卡片根据宝宝实际月龄动态调整建议：

```
┌─────────────────────────────────┐
│  [宝宝🍼] 12个月+ 适用          │
│                                 │
│  将鸡蛋炒至半熟，压成小颗粒    │
│  （不用压泥，练习咀嚼）        │
│                                 │
│  ⚠️ 你的宝宝 10个月             │
│  建议：压成细腻的蛋泥           │
│                                 │
│  📖 为什么？                    │
└─────────────────────────────────┘
```

点击"为什么？"展开科学依据（1-2句，如"10个月宝宝咀嚼肌尚未发育完全，过大颗粒有噎呛风险"）。

### 过敏风险提示

首次出现高风险食材时一次性弹窗：

```
🥜 花生 — 过敏高风险食材
建议首次单独少量尝试，观察24小时
如宝宝已尝试过且无反应，可正常使用
[已了解，继续]  [从宝宝版移除]
```

高风险食材列表：花生、虾、蟹、蛋白、牛奶（<12月）、蜂蜜（<12月）、整颗坚果（<36月）

### 数据层（无需改数据库）

1. **新增** `frontend/src/constants/babyAgeRules.ts` — 月龄规则配置表
   - 食材风险等级（高/中/低）
   - 质地建议（按月龄段：泥状/细碎/小块/正常）
   - 首次引入建议月龄
2. 烹饪模式渲染宝宝步骤时，根据用户 Profile 的宝宝月龄实时匹配规则
3. 复用后端已有的 `isIngredientSuitable` 函数逻辑（移植到前端常量）

### 涉及文件

- **新增** `frontend/src/constants/babyAgeRules.ts` — 月龄规则配置
- **新增** `frontend/src/components/cooking/BabyStepCard.tsx` — 宝宝步骤卡片（含月龄适配）
- **新增** `frontend/src/components/cooking/AllergyAlert.tsx` — 过敏提示组件

---

## 六、实施优先级

```
Phase A（1-2周）: 烹饪模式框架
├── CookingModeScreen 全屏界面
├── StepCard + StepTimer 组件
├── expo-keep-awake 屏幕常亮
├── 进度持久化（AsyncStorage）
└── 导航注册 + "开始烹饪"入口

Phase B（1周）: 语音 + 手势 + 提醒
├── expo-speech 语音播报
├── expo-haptics 震动
├── 手势识别（左右滑 / 双击 / 长按）
└── 时间交叉主动提醒 Modal

Phase C（1周）: 月龄精细化
├── babyAgeRules.ts 配置表
├── BabyStepCard 月龄适配展示
└── AllergyAlert 过敏提示
```

---

## 七、不做的事

| 诱惑 | 为什么不做 |
|------|-----------|
| 系统推送通知提醒 | 需要权限申请，应用内弹窗已足够 |
| AR 烹饪辅助 | 技术复杂度极高，超出当前阶段 |
| 视频步骤教程 | 内容成本高，文字+语音已能解决核心问题 |
| 自定义月龄规则 | 科学依据应统一，用户自定义会引入安全风险 |
