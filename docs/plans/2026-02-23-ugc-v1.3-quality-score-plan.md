# UGC V1.3 质量评分与推荐入池规则方案

日期：2026-02-23  
负责人：OneDish 后端/前端协作

## 1. 背景与目标

为 UGC（用户投稿）建立最小可用的“质量评分 + 推荐入池”机制，支撑：
- 投稿质量可量化（便于运营与治理）
- 推荐流可混排“官方菜谱 + 高质量UGC”
- 对风险/低质量内容可自动降权或剔除

> 对标下厨房：我们不只看“好看/好评”，更强调 **可执行 + 宝宝安全**，保证一菜两吃场景下的家庭可落地性。

## 2. 评分维度（总分 100）

### 2.1 完整度（0~25）
- 标题存在且长度 >= 4（+6）
- 成人版食材 >= 2（+7）
- 宝宝版食材 >= 2（+7）
- 月龄范围存在（+5）

### 2.2 安全性（0~35）
- 风险命中 `block`：直接记 0，且触发入池剔除
- 风险命中仅 `warn`：按条扣分（每条 -6，最低 5）
- 无命中：35

### 2.3 可执行性（0~25）
- prep_time 在 10~40 分钟（+8）
- 存在步骤分叉/备注（step_branches）体现一菜两吃执行路径（+8）
- 难度有值且 servings 有值（+9）

### 2.4 反馈表现（0~15）
- 低举报（report_count=0）给基础分（+8）
- 采纳率 adoption_rate（0~1）映射 0~7 分

## 3. 入池阈值

- `quality_score >= 75` 且 `status=published` 且 `is_active=true` 且未命中 block 风险
- 满足后 `in_recommend_pool=true`
- 否则 `in_recommend_pool=false`

## 4. 降权/剔除规则

### 4.1 被举报
- `report_count >= 3`：直接剔除推荐池
- `report_count = 1~2`：保留但反馈表现降分

### 4.2 低采纳率
- `adoption_rate < 0.15`：降权（可留池但排序靠后，当前最小版通过评分反映）
- `adoption_rate < 0.08`：剔除推荐池

### 4.3 风险命中
- 命中 `block`：剔除推荐池，禁止推荐
- 仅 `warn`：允许发布但扣分，默认不触发剔除

## 5. 推荐混排策略（最小可用）

新增开关：`RECOMMEND_MIX_UGC_ENABLED`（默认 true）
- 关闭：沿用官方 recipes 推荐
- 开启：每日推荐从官方与UGC池进行混排抽样
  - 建议比重：官方 70% / UGC 30%
  - 当前最小实现：按随机概率尝试命中UGC，命不中回退官方

## 6. 管理接口（最小可用）

- `POST /api/v1/user-recipes/admin/recompute-quality`
  - 管理员触发全量或指定ID重算 quality_score + 入池标记
- `GET /api/v1/user-recipes/admin/recommend-pool`
  - 管理员查看当前入池清单

## 7. 前端呈现

在投稿/广场卡片增加质量标签：
- `推荐入池`（绿色）
- `待优化`（灰/橙）

保持交互简洁：仅展示标签与分数，不引入复杂配置。

## 8. 风险与边界

- 当前反馈表现依赖字段 `report_count/adoption_rate`，初期由后台管理/离线任务写入
- 规则打分非最终算法，后续可升级为学习排序模型
- 混排在“今日推荐单条”场景以概率方式实现，后续可扩展为列表级混排

## 9. 里程碑

1) 文档先行（本文件 + 测试计划）  
2) 后端最小实现（字段 + 打分 + 管理接口 + 推荐混排）  
3) 前端标签展示  
4) 构建/类型检查/专项验证  
5) 形成测试报告与实现文档
